<section class="listing-edit-page">
  <app-section-heading
    eyebrow="Listing Management"
    title="Edit Listing"
    description="Update the details of your waste material listing."
  />

  <form [formGroup]="form" (ngSubmit)="submit()" class="edit-form card">
    <div class="form-section">
      <h3>Basic Information</h3>
      <div class="form-grid">
        <label>
          Listing Title
          <input type="text" formControlName="title" placeholder="e.g. Copper wiring scraps" />
          <span class="error" *ngIf="form.get('title')?.touched && form.get('title')?.invalid">
            Title is required
          </span>
        </label>

        <label>
          Material Description
          <input type="text" formControlName="material" placeholder="e.g. Insulated copper wire bundles" />
          <span class="error" *ngIf="form.get('material')?.touched && form.get('material')?.invalid">
            Description is required
          </span>
        </label>

        <label>
          Category
          <select formControlName="category">
            <option *ngFor="let cat of categories" [value]="cat">{{ cat | titlecase }}</option>
          </select>
        </label>

        <label>
          Quantity (Tons)
          <input type="number" formControlName="quantityTons" min="1" />
          <span class="error" *ngIf="form.get('quantityTons')?.touched && form.get('quantityTons')?.invalid">
            Valid quantity required
          </span>
        </label>
      </div>
    </div>

    <div class="form-section">
      <h3>Logistics & Pricing</h3>
      <div class="form-grid">
        <label>
          Location (City/Region)
          <input type="text" formControlName="location" placeholder="e.g. Sfax Industrial Zone" />
          <span class="error" *ngIf="form.get('location')?.touched && form.get('location')?.invalid">
            Location is required
          </span>
        </label>

        <label>
          Price per Ton (TND)
          <input type="number" formControlName="pricePerTon" min="0" />
          <span class="error" *ngIf="form.get('pricePerTon')?.touched && form.get('pricePerTon')?.invalid">
            Price is required
          </span>
        </label>

        <label>
          Available From
          <input type="date" formControlName="availableFrom" />
          <span class="error" *ngIf="form.get('availableFrom')?.touched && form.get('availableFrom')?.invalid">
            Start date is required
          </span>
        </label>

        <label>
          Expires On
          <input type="date" formControlName="expiresOn" />
          <span class="error" *ngIf="form.get('expiresOn')?.touched && form.get('expiresOn')?.invalid">
            End date is required
          </span>
        </label>
      </div>

      <div class="form-group full-width">
        <label>
          Pickup Requirements
          <textarea formControlName="pickupRequirements" rows="3" placeholder="e.g. Forklift required, palletized only..."></textarea>
        </label>
      </div>
    </div>

    <div class="form-section">
      <h3>Documents & Photos</h3>
      <div class="upload-area">
        <p>Upload photos, certifications, or lab reports</p>
        <input type="file" multiple (change)="onDocumentSelect($event)" />
      </div>
      
      <div class="uploads-list" *ngIf="uploads.length > 0">
        <div class="upload-item" *ngFor="let upload of uploads">
          <span class="filename">{{ upload.fileName }}</span>
          <div class="progress-bar">
            <div class="fill" [style.width.%]="upload.progress"></div>
          </div>
          <span class="status" *ngIf="upload.completed">âœ“</span>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" class="btn-ghost" routerLink="/listings">Cancel</button>
      <button type="submit" class="btn-primary" [disabled]="pending">
        {{ pending ? 'Saving...' : 'Save Changes' }}
      </button>
    </div>

    <p class="submission-message" *ngIf="submissionMessage">{{ submissionMessage }}</p>
  </form>
</section>

